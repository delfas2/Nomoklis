{% extends 'nomoklis_app/_landlord_base.html' %}

{% block title %}Mano NT Objektai{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-8">
    <div>
        <h1 class="text-3xl font-bold text-gray-800">Mano NT Objektai</h1>
        <p class="mt-1 text-gray-600">Čia galite matyti ir valdyti savo nuomojamą turtą.</p>
    </div>
    <a href="{% url 'add_property' %}" class="bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-blue-700 transition duration-300">
        Pridėti naują
    </a>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
    {% for property in properties %}
    <div x-data="{ confirmDelete: false }" class="bg-white rounded-xl shadow-lg overflow-hidden transform hover:-translate-y-1 transition-transform duration-300">
        <div class="relative">
            <img class="w-full h-56 object-cover" src="{% if property.images.first %}{{ property.images.first.image.url }}{% else %}https://placehold.co/600x400/d1d5db/333333?text=Nėra+nuotraukos{% endif %}" alt="Turto nuotrauka">
            <div class="absolute top-4 right-4">
                <span class="px-3 py-1 text-xs font-semibold rounded-full text-white
                    {% if property.status == 'isnuomotas' %} bg-green-500 
                    {% elif property.status == 'paruostas' %} bg-blue-500
                    {% else %} bg-gray-500 
                    {% endif %}">
                    {{ property.get_status_display }}
                </span>
            </div>
        </div>
        <div class="p-6">
            <h3 class="text-xl font-bold text-gray-800 mb-2">{{ property.street }}, {{ property.city }}</h3>
            <div class="flex justify-between items-center pt-2 border-t border-gray-100">
                <p class="text-xl font-bold text-blue-600">{{ property.rent_price|floatformat:"0" }} €<span class="text-sm font-normal text-gray-500">/mėn.</span></p>
                <div class="flex items-center space-x-2">
                    <button @click="confirmDelete = true" type="button" class="p-2 rounded-full text-gray-400 hover:bg-red-100 hover:text-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>
                    </button>
                    <a href="{% url 'edit_property' property.id %}" class="inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Tvarkyti
                    </a>
                </div>
            </div>
        </div>

        <!-- Trynimo patvirtinimo modalinis langas -->
        <div x-show="confirmDelete" class="fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50" style="display: none;">
            <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md" @click.away="confirmDelete = false">
                <h3 class="text-lg font-medium text-gray-900">Ar tikrai norite ištrinti šį objektą?</h3>
                <p class="mt-2 text-sm text-gray-500">Šis veiksmas yra negrįžtamas. Visi su šiuo NT objektu susiję duomenys bus visam laikui pašalinti.</p>
                <div class="mt-5 sm:mt-6 sm:grid sm:grid-cols-2 sm:gap-3 sm:grid-flow-row-dense">
                    <form action="{% url 'delete_property' property.id %}" method="post" class="w-full">
                        {% csrf_token %}
                        <button type="submit" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:col-start-2 sm:text-sm">Taip, ištrinti</button>
                    </form>
                    <button @click="confirmDelete = false" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:col-start-1 sm:text-sm">Atšaukti</button>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-span-full text-center py-10 bg-white rounded-lg shadow-md">
        <h2 class="text-2xl font-bold text-gray-800">Jūs dar nepridėjote jokio NT objekto</h2>
        <p class="text-gray-600 mt-2">Pradėkite pridėdami savo pirmąjį nuomojamą turtą.</p>
        <a href="{% url 'add_property' %}" class="mt-4 inline-block bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition">Pridėti NT objektą</a>
    </div>
    {% endfor %}
</div>
{% endblock %}